<!doctype html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="author" content="Paul Lewis" />
  <meta name="viewport" content="width=device-width">
  <meta name="theme-color" content="#2F7F8A">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="//aerotwist.com/tutorials/feed/">
  

  

  <style>
    
    @font-face {
      font-family: 'Lato';
      font-style: normal;
      font-weight: 400;
      font-display: block;
      src: local('Lato Regular'), local('Lato-Regular'), url(//themes.googleusercontent.com/static/fonts/lato/v7/qIIYRU-oROkIk8vfvxw6QvesZW2xOQ-xsNqO47m55DA.woff) format('woff');
    }
    

    @font-face {
      font-family: 'Lato';
      font-style: normal;
      font-weight: 700;
      font-display: block;
      src: local('Lato Bold'), local('Lato-Bold'), url(//themes.googleusercontent.com/static/fonts/lato/v7/qdgUG4U09HnJwhYI-uK18wLUuEpTyoUstqEm5AMlJo4.woff) format('woff');
    }
  </style>

  <link rel="stylesheet" media="screen" href="/css/aerotwist.css" />
  <title>Aerotwist - Getting Started with Three.js</title>
  
  <style>
    .masthead h2 {
      display: none;
    }

    .masthead {
      background-image: url(/static/tutorials/headers/header-intro-three-small.jpg);
      
      background-color: #222;
      
      
    }

    .meta {
      background-color: #222 !important;
    }

    @media (min-width: 600px) {
      .masthead {
        background-image: url(/static/tutorials/headers/header-intro-three.jpg);
      }
    }
  </style>
  

  
</head>


<!--
                              __          .__          __
  _____    ___________  _____/  |___  _  _|__| _______/  |_
  \__  \ _/ __ \_  __ \/  _ \   __\ \/ \/ /  |/  ___/\   __\
   / __ \\  ___/|  | \(  <_> )  |  \     /|  |\___ \  |  |
  (____  /\___  >__|   \____/|__|   \/\_/ |__/____  > |__|
       \/     \/                                  \/

  Giant ascii art embedded in every page of your site is how you
  show other people that YOU CARE. Mainly I care about developers,
  which is what I presume you are if you're all about viewing
  the source. Clearly you're my kind of person.

  This is v3, it's run through Jekyll, it's been fun to build,
  there's always more to do, and you may notice that aside from
  Google Analytics there is no JavaScript. None.

  That's one way of many you keep your pages fast. I care about
  keeping this site fast because your time is precious and I need
  to get out of your way.

  <3'z

  Paul
-->


  <body class="tutorials">

    <header>
      <div class="container">
        <div id="logo">
  <a href="/">
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
       width="100%" height="100%">
    <g>
      <polygon fill-rule="evenodd" clip-rule="evenodd" fill="#C8A47F" points="30.6,47.73 64.92,47.73 19.97,76.52"></polygon>
      <polygon fill-rule="evenodd" clip-rule="evenodd" fill="#A9E9FF" points="48.198,0 53.008,14.06 39.31,24.76"></polygon>
      <polygon fill-rule="evenodd" clip-rule="evenodd" fill="#2F7F8A" points="39.31,24.76 64.92,48 30.6,48"></polygon>
      <polygon fill-rule="evenodd" clip-rule="evenodd" fill="#29C9FF" points="39.31,24.76 64.92,48 53.008,14.06"></polygon>
      <polygon fill-rule="evenodd" clip-rule="evenodd" fill="#402000" points="30.6,48 64.92,48 48,58.69"></polygon>
      <polygon fill-rule="evenodd" clip-rule="evenodd" fill="#924900" points="47.76,58.69 64.92,47.73 75.14,76.73"></polygon>
    </g>
    </svg>
  </a>
</div>

        <nav>
  <ul>
    
      
        <li><a href="/">Home</a></li>
      
    
      
        <li><a href="/blog/">Blog</a></li>
      
    
      
        <li class="active"><a href="/tutorials/"> Tutorials</a></li>
      
    
      
        <li><a href="/lab/">Lab</a></li>
      
    
  </ul>

  <svg id="left-line" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
       width="380px" height="380px" viewBox="0 0 380 380">
    <line x1="0" y1="380" x2="380" y2="0" stroke="#AAAAAA" stroke-width="1" />
    </svg>

  <svg id="right-line" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
       width="380px" height="380px" viewBox="0 0 380 380">
    <line x1="0" y1="380" x2="380" y2="0" stroke="#C8A47F" stroke-opacity="0.3" stroke-width="1" />
    </svg>
</nav>

      </div>
    </header>
    <section>

      <div class="content">

  <div class="masthead">

    <div class="container">
      <h2>Getting Started with Three.js</h2>
      <p></p>
    </div>

  </div>

  

  

  <div class="container"><div class="left column">

<p><strong>Please note: this has been tested with Three.js r82</strong></p>

<p>I have used <a href="https://github.com/mrdoob/three.js/">Three.js</a> for some of my
experiments, and it does a really great job of abstracting away the headaches
of getting going with 3D in the browser. With it you can create cameras,
objects, lights, materials and more, and you have a choice of renderer, which
means you can decide if you want your scene to be drawn using HTML 5’s canvas,
WebGL or SVG. And since it’s open source you could even get involved with the
project. But right now I’ll focus on what I’ve learned by playing with it as
an engine, and talk you through some of the basics.</p>

<p>For all the awesomeness of Three.js, there can be times where you might
struggle. Typically you will need to spend quite a large amount of time with
the examples, reverse engineering and (in my case certainly) hunting down
specific functionality and occasionally asking questions via GitHub. If you
have to ask questions, by the way, you should do that on <a href="http://stackoverflow.com/tags/three.js/info">Stack
Overflow</a>!</p>

<h2 id="the-basics">The basics</h2>

<p>I will assume that you have at least a passing knowledge of 3D, and reasonable
proficiency with JavaScript. If you don’t it may be worth learning a bit
before you try and play with this stuff, as it can get a little confusing.</p>

<p>In our 3D world we will have some of the following, which I will guide you
through the process of creating:</p>

<ol>
  <li>A scene</li>
  <li>A renderer</li>
  <li>A camera</li>
  <li>An object or two (with materials)</li>
</ol>

<p>You can, of course, do some crazy things, and my hope is that you will go on
to do that and start to experiment with 3D in your browser.</p>

<h2 id="support">Support</h2>

<p>WebGL support is really awesome nowadays: Chrome, Firefox, Safari, Internet
Explorer and Edge all support WebGL. So there’s little reason to not use it!</p>

<h2 id="set-the-scene">Set the Scene</h2>

<p>I’ll assume you’ve chosen a browser that supports all the rendering
technologies, and that you want to render with Canvas or WebGL, since they’re
the more standard choices. Canvas is more widely supported than WebGL, but
it’s worth noting that WebGL runs on your graphics card’s GPU, which means
that your CPU can concentrate on other non-rendering tasks like any physics or
user interaction you’re trying to do.</p>

<p>Irrespective of your chosen renderer you should bear in mind that the
JavaScript will need to optimised for performance. 3D isn’t a lightweight task
for a browser (and it’s awesome that it’s even possible), so be careful to
understand where any bottlenecks are in your code, and remove them if you can!</p>

<p>So with that said, and on the assumption <a href="https://github.com/mrdoob/three.js/archive/master.zip">you have
downloaded</a> and included
three.js in your HTML file, how do you go about setting up a scene? Like this:
</div></div></p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Set the scene size.</span>
<span class="kr">const</span> <span class="nx">WIDTH</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">HEIGHT</span> <span class="o">=</span> <span class="mi">300</span><span class="p">;</span>

<span class="c1">// Set some camera attributes.</span>
<span class="kr">const</span> <span class="nx">VIEW_ANGLE</span> <span class="o">=</span> <span class="mi">45</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">ASPECT</span> <span class="o">=</span> <span class="nx">WIDTH</span> <span class="o">/</span> <span class="nx">HEIGHT</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">NEAR</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">FAR</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>

<span class="c1">// Get the DOM element to attach to</span>
<span class="kr">const</span> <span class="nx">container</span> <span class="o">=</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;#container&#39;</span><span class="p">);</span>

<span class="c1">// Create a WebGL renderer, camera</span>
<span class="c1">// and a scene</span>
<span class="kr">const</span> <span class="nx">renderer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">WebGLRenderer</span><span class="p">();</span>
<span class="kr">const</span> <span class="nx">camera</span> <span class="o">=</span>
    <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PerspectiveCamera</span><span class="p">(</span>
        <span class="nx">VIEW_ANGLE</span><span class="p">,</span>
        <span class="nx">ASPECT</span><span class="p">,</span>
        <span class="nx">NEAR</span><span class="p">,</span>
        <span class="nx">FAR</span>
    <span class="p">);</span>

<span class="kr">const</span> <span class="nx">scene</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Scene</span><span class="p">();</span>

<span class="c1">// Add the camera to the scene.</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">camera</span><span class="p">);</span>

<span class="c1">// Start the renderer.</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nx">setSize</span><span class="p">(</span><span class="nx">WIDTH</span><span class="p">,</span> <span class="nx">HEIGHT</span><span class="p">);</span>

<span class="c1">// Attach the renderer-supplied</span>
<span class="c1">// DOM element.</span>
<span class="nx">container</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">renderer</span><span class="p">.</span><span class="nx">domElement</span><span class="p">);</span></code></pre></div>

<div class="container"><div class="left column">

<p>Not too tricky, really!</p>

<h2 id="making-a-mesh">Making a Mesh</h2>

<p>So we have a scene, a camera and a renderer (I opted for a WebGL one in my
sample code) but we have nothing to actually draw. Three.js actually comes
with support for loading a few different standard file types, which is great
if you are outputting models from Blender, Maya, Cinema4D or anything else. To
keep things simple (this is about getting started after all!) I’ll talk about
primitives. Primitives are geometric meshes, relatively basic ones like
Spheres, Planes, Cubes and Cylinders. Three.js lets you create these types of
primitives easily:
</div></div></p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Set up the sphere vars</span>
<span class="kr">const</span> <span class="nx">RADIUS</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">SEGMENTS</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
<span class="kr">const</span> <span class="nx">RINGS</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>

<span class="c1">// Create a new mesh with</span>
<span class="c1">// sphere geometry - we will cover</span>
<span class="c1">// the sphereMaterial next!</span>
<span class="kr">const</span> <span class="nx">sphere</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span>

  <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">SphereGeometry</span><span class="p">(</span>
    <span class="nx">RADIUS</span><span class="p">,</span>
    <span class="nx">SEGMENTS</span><span class="p">,</span>
    <span class="nx">RINGS</span><span class="p">),</span>

  <span class="nx">sphereMaterial</span><span class="p">);</span>

<span class="c1">// Move the Sphere back in Z so we</span>
<span class="c1">// can see it.</span>
<span class="nx">sphere</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">300</span><span class="p">;</span>

<span class="c1">// Finally, add the sphere to the scene.</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">sphere</span><span class="p">);</span></code></pre></div>

<div class="container"><div class="left column">
<p>All good, but what about the material for the sphere? In the code we’ve used
a variable <strong>sphereMaterial</strong> but we’ve not defined it yet. First we need to
talk about materials in a bit more detail.</p>

<h2 id="materials">Materials</h2>

<p>Without doubt this is one of the most useful parts of Three.js. It provides
for you a number of common (and very handy) materials to apply to your meshes:</p>

<ol>
  <li>Basic, which just means that it renders ‘unlit’.</li>
  <li>Lambert.</li>
  <li>Phong.</li>
</ol>

<p>There are more, but again in the interests of simplicity I’ll let you discover
those for yourself. In the case of WebGL particularly these materials can be a
life-saver. Why? Well because in WebGL you have to write shaders for
everything being rendered. <a href="../an-
introduction-to-shaders-part-1">Shaders are a huge topic in themselves</a>, but in short they are written in GLSL (OpenGL
Shader Language), which tells the GPU how something should look. This means
you need to mimic the maths of lighting, reflection and so on. It can get very
complicated very quickly. Thanks to Three.js you don’t have to do this if you
don’t want to because it abstracts that away for you. If you want to write
shaders, however, you can do that too with a MeshShaderMaterial, so it’s a
flexible setup.</p>

<p>For now, however, let’s apply a lambert material to the sphere:
</div></div></p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// create the sphere&#39;s material</span>
<span class="kr">const</span> <span class="nx">sphereMaterial</span> <span class="o">=</span>
  <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshLambertMaterial</span><span class="p">(</span>
    <span class="p">{</span>
      <span class="nx">color</span><span class="o">:</span> <span class="mh">0xCC0000</span>
    <span class="p">});</span></code></pre></div>

<div class="container"><div class="left column">
<p>It’s worth pointing out as well that there are other properties you can
specify when you create a material besides the colour, such as smoothing or
environment maps. You should <a href="http://threejs.org/docs/">check out the docs</a>
for the various properties you can set on the materials and, in fact, any
object that the engine provides for you.</p>

<h2 id="lights">Lights!</h2>

<p>If you were to render the scene right now you’d see a red circle. Even though
we have a Lambert material applied there’s no light in the scene so by default
Three.js will revert to a full ambient light, which is the same as flat
colouring. Let’s fix that with a simple point of light:
</div></div></p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// create a point light</span>
<span class="kr">const</span> <span class="nx">pointLight</span> <span class="o">=</span>
  <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">PointLight</span><span class="p">(</span><span class="mh">0xFFFFFF</span><span class="p">);</span>

<span class="c1">// set its position</span>
<span class="nx">pointLight</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="nx">pointLight</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">y</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
<span class="nx">pointLight</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">z</span> <span class="o">=</span> <span class="mi">130</span><span class="p">;</span>

<span class="c1">// add to the scene</span>
<span class="nx">scene</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">pointLight</span><span class="p">);</span></code></pre></div>

<div class="container"><div class="left column">
<p>## Render Loop</p>

<p>We now actually have everything set up to render, remarkably. But we actually
need to go ahead and do just that:
</div></div></p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Draw!</span>
<span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span> <span class="nx">camera</span><span class="p">);</span></code></pre></div>

<div class="container"><div class="left column">
<p>You’re probably going to want to render
more than once, though, so if you’re going to do a loop you should really use
<code>requestAnimationFrame</code>; it’s by far the smartest way of handling animation in
the browser. That render call above just needs wrapping, like this:</p>

</div></div>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">function</span> <span class="nx">update</span> <span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Draw!</span>
  <span class="nx">renderer</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">scene</span><span class="p">,</span> <span class="nx">camera</span><span class="p">);</span>

  <span class="c1">// Schedule the next frame.</span>
  <span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">update</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Schedule the first frame.</span>
<span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">update</span><span class="p">);</span></code></pre></div>

<div class="container"><div class="left column">

<p>And we’re good.</p>

<h2 id="common-object-properties">Common Object Properties</h2>

<p>If you take time to look through the code for Three.js you’ll see a lot of
objects “inherit” from Object3D. This is a base object which contains some
very useful properties, such as the <strong>position</strong>, <strong>rotation</strong> and <strong>scale</strong>
information. In particular our Sphere is a Mesh which inherits from Object3D,
to which it adds its own properties: <strong>geometry</strong> and <strong>materials</strong>. Why do I
mention these? Well it’s unlikely you’re going to want to just have a sphere
on your screen that does nothing, and these properties are worth investigating
as they allow you to manipulate the underlying details of the meshes and
materials on the fly.</p>

</div></div>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// sphere geometry</span>
<span class="nx">sphere</span><span class="p">.</span><span class="nx">geometry</span>

<span class="c1">// which contains the vertices and faces</span>
<span class="nx">sphere</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">vertices</span> <span class="c1">// an array</span>
<span class="nx">sphere</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">faces</span> <span class="c1">// also an array</span>

<span class="c1">// its position</span>
<span class="nx">sphere</span><span class="p">.</span><span class="nx">position</span> <span class="c1">// contains x, y and z</span>
<span class="nx">sphere</span><span class="p">.</span><span class="nx">rotation</span> <span class="c1">// same</span>
<span class="nx">sphere</span><span class="p">.</span><span class="nx">scale</span> <span class="c1">// ... same</span></code></pre></div>

<div class="container"><div class="left column">

<h2 id="dirty-little-secrets">Dirty Little Secrets</h2>

<p>I just wanted to quickly point out a quick gotcha for Three.js, which is that
if you modify, for example, the vertices of a mesh, you will notice in your
render loop that nothing changes. Why? Well because Three.js (as far as I can
tell) caches the data for a mesh as something of an optimisation. What you
actually need to do is to flag to Three.js that something has changed so it
can recalculate whatever it needs to. You do this with the following:
</div></div></p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="c1">// Changes to the vertices</span>
<span class="nx">sphere</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">verticesNeedUpdate</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="c1">// Changes to the normals</span>
<span class="nx">sphere</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">normalsNeedUpdate</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></code></pre></div>

<div class="container"><div class="left column">
<p>Again there are more, but those two I’ve found are the most useful. You
should obviously only flag the things that have changed to avoid unnecessary
calculations.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Well I hope you’ve found this brief introduction to Three.js helpful. There’s
nothing quite like actually getting your hands dirty and trying something, and
I can’t recommend it highly enough. 3D running natively in the browser is a
lot of fun, and using an engine like Three.js takes away a lot of the
headaches for you and lets you get to making some seriously cool stuff.</p>

<p>To help you out a bit I’ve <a href="/static/tutorials/getting-started-with-three-js/sample.zip">wrapped up the source code</a> in this
lab article, so you can use that as a reference.</p>

<p>If you’ve enjoyed this let me know via <a href="http://twitter.com/aerotwist">Twitter</a>,
it’s always good to say hello!
</div></div></p>


</div>


    </section>

    <footer>

      <div class="container">
        <div class="bio panel">
          <h2>Hello!</h2>
          <p>My name is Paul. I work at <a href="http://www.google.com/" title="Yay Google!">Google</a> on the Chrome team as an engineer. I create sites & apps for the web.</p>

          <p>You can find me on <a href="http://twitter.com/aerotwist">Twitter</a> and <a href="http://www.google.com/+aerotwist">G+</a></p>
        </div>

        <div class="get-in-touch panel">
          <h2>Get in touch</h2>
          <p>I don’t bite. Honestly. You can find me on <a href="https://twitter.com/aerotwist">Twitter</a> and <a href="http://www.youtube.com/aerotwist">YouTube</a>, and I like hearing from people so say hi.</p>
        </div>

        <div class="subscribe panel">
          <h2>Subscribe</h2>
          <p>You should totally get the <a href="/blog/feed/">RSS feed</a>, or whatever it is you kids are using these days (I miss Reader.)</p>
        </div>

        <p class="disclaimer">Except as otherwise noted, the content of this page is licensed under the Creative Commons Attribution 3.0 License, and code samples are licensed under the Apache 2.0 License.</p>
      </div>
    </footer>

    <script>
      async function init() {
        if (!('serviceWorker' in navigator)) {
          return;
        }

        const registration = await navigator.serviceWorker.register("/sw.js");
        registration.onupdatefound = () => {
          console.log("Installing new service worker...");

          registration.installing.onstatechange = function() {
            console.log(this.state);
          };
        }
      }

      init();
    </script>

    <script async="true">

    /**
     * Snow effect, from: HTML5 Rocks
     * https://github.com/html5rocks/www.html5rocks.com/blob/9318b5755c8c17a4bd1761bca6b1b491e7fd17b8/content/index.html
     */
    !function(){function j(){f=c.clientWidth,g=c.clientHeight,d.width=f,d.height=g,e.fillStyle="#FFF";var a=i;i=f>600,!a&&i&&requestAnimFrame(n)}function n(){if(e.clearRect(0,0,f,g),i){for(h=0;b>h;h++)m=l[h],m.y+=m.vy,m.x+=m.vx,e.globalAlpha=m.o,e.beginPath(),e.arc(m.x,m.y,m.r,0,2*Math.PI,!1),e.closePath(),e.fill(),m.y>g&&m.reset();requestAnimFrame(n)}}var a=(new Date).getMonth();if(11===a){var b=100,c=document.querySelector(".masthead");if(c){var d=document.createElement("canvas"),e=d.getContext("2d"),f=c.clientWidth,g=c.clientHeight,h=0,i=!1,k=function(){this.x=0,this.y=0,this.vy=0,this.vx=0,this.r=0,this.reset()};k.prototype.reset=function(){this.x=Math.random()*f,this.y=Math.random()*-g,this.vy=1+3*Math.random(),this.vx=.5-Math.random(),this.r=1+2*Math.random(),this.o=.5+.5*Math.random()},d.style.position="absolute",d.style.left=d.style.top="0";var m,l=[];for(h=0;b>h;h++)m=new k,m.reset(),l.push(m);window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),j(),window.addEventListener("resize",j,!1),c.appendChild(d)}}

    if (new Date().getMonth() !== 11) {
      return;
    }

    if (!('IntersectionObserver' in window)) {
      return;
    }

    var masthead = document.querySelector('.masthead');
    if (!masthead) {
      return;
    }

    var observer = new IntersectionObserver(function(entries) {
      entries.sort(function(a, b) {
        return b.time - a.time;
      });

      var isActive = i;
      i = entries[0].intersectionRatio > 0.01;

      if (i && !isActive) {
        console.log('***** LET IT SNOWWWWW!!!! *****');
        requestAnimFrame(n);
      } else {
        if (i !== isActive) {
          console.log('Forecast: no snow.');
        }
      }

    }, { rootMargin: '0px', threshold: 0.01 });

    observer.observe(masthead);
    }();
    </script>
  </body>
</html>
